<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.OrganizationMapper">
    <select id="selectAll" parameterType="com.example.entity.User" resultType="com.example.entity.User">
        SELECT *, d.name AS departmentName, r.name AS roleName
        FROM user
            LEFT JOIN department d on user.department_id = d.id
            LEFT JOIN role r on user.role_id = r.id
    </select>

    <select id="selectByName" parameterType="com.example.entity.User" resultType="com.example.entity.User">
        SELECT *, d.name AS departmentName, r.name AS roleName
        FROM user
                 LEFT JOIN department d on user.department_id = d.id
                 LEFT JOIN role r on user.role_id = r.id
        WHERE user.username like CONCAT('%', #{name}, '%')
    </select>

    <insert id="addUser" parameterType="com.example.entity.User">
        INSERT INTO `user` (username, password, email, status, created_at, updated_at, role_id, department_id)
        values (#{username}, #{password}, #{email}, #{status}, #{createdAt}, #{updatedAt}, #{roleId}, #{departmentId})
    </insert>

    <delete id="deleteUser" parameterType="integer">
        DELETE from `user` where id = #{id}
    </delete>

    <update id="updateUser" parameterType="com.example.entity.User">
        UPDATE `user`
        SET
            username = #{username},
            password = #{password},
            email = #{email},
            department_id = #{departmentId},
            role_id = #{roleId},
            status = #{status}
        WHERE id = #{id}
    </update>

</mapper>